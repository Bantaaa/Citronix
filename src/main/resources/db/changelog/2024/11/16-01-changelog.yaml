databaseChangeLog:
  # Add UUID extension
  - changeSet:
      id: uuid-extension
      author: Youcode
      changes:
        - sql:
            sql: CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

  # Create farm table
  - changeSet:
      id: create-farm-table
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - createTable:
            tableName: farm
            columns:
              - column:
                  name: id
                  type: UUID
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(255)
              - column:
                  name: location
                  type: VARCHAR(255)
              - column:
                  name: area
                  type: FLOAT
              - column:
                  name: date_established
                  type: DATE

  # Create field table
  - changeSet:
      id: create-field-table
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - createTable:
            tableName: field
            columns:
              - column:
                  name: id
                  type: UUID
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: area
                  type: FLOAT
              - column:
                  name: farm_id
                  type: UUID

  # Create tree table
  - changeSet:
      id: create-tree-table
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - createTable:
            tableName: tree
            columns:
              - column:
                  name: id
                  type: UUID
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: date_planted
                  type: DATE
              - column:
                  name: field_id
                  type: UUID

  # Add not null constraints
  - changeSet:
      id: add-farm-constraints
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - addNotNullConstraint:
            columnName: name
            tableName: farm
            columnDataType: VARCHAR(255)
        - addNotNullConstraint:
            columnName: location
            tableName: farm
            columnDataType: VARCHAR(255)
        - addNotNullConstraint:
            columnName: area
            tableName: farm
            columnDataType: FLOAT
        - addNotNullConstraint:
            columnName: date_established
            tableName: farm
            columnDataType: DATE

  - changeSet:
      id: add-field-constraints
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - addNotNullConstraint:
            columnName: area
            tableName: field
            columnDataType: FLOAT
        - addNotNullConstraint:
            columnName: farm_id
            tableName: field
            columnDataType: UUID

  - changeSet:
      id: add-tree-constraints
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - addNotNullConstraint:
            columnName: date_planted
            tableName: tree
            columnDataType: DATE
        - addNotNullConstraint:
            columnName: field_id
            tableName: tree
            columnDataType: UUID

  # Add foreign key constraints
  - changeSet:
      id: add-field-foreign-key
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: farm_id
            baseTableName: field
            constraintName: FK_FIELD_ON_FARM
            referencedColumnNames: id
            referencedTableName: farm

  - changeSet:
      id: add-tree-foreign-key
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - addForeignKeyConstraint:
            baseColumnNames: field_id
            baseTableName: tree
            constraintName: FK_TREE_ON_FIELD
            referencedColumnNames: id
            referencedTableName: field

  # Add indexes (optional but recommended for foreign keys)
  - changeSet:
      id: add-indexes
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - createIndex:
            indexName: idx_field_farm_id
            tableName: field
            columns:
              - column:
                  name: farm_id
        - createIndex:
            indexName: idx_tree_field_id
            tableName: tree
            columns:
              - column:
                  name: field_id